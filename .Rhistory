sep = "\\.") %>%
mutate(side.nerve = paste(side, nerve, sep=".")) %>%
mutate(side.nerve = factor(side.nerve,
levels =
c("R.MM", "R.UM", "R.PM", "R.TM",
"L.TM", "L.PM", "L.UM", "L.MM"))) %>%
filter(param %in% c("CMAP1", "CMAP2", "CMAP3", "CMAP4",
"DML", "Dur1", "Dur2", "Dur3", "Dur4",
"NCV1", "NCV2", "NCV3", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2", "CMAP3", "CMAP4",
"DML", "Dur1", "Dur2", "Dur3", "Dur4",
"NCV1", "NCV2", "NCV3", "FL"))) %>%
select(Date, side.nerve, param, value)
head(tab_motor)
fu_selected = tab_motor
levels(tab_motor$side.nerve)
levels(tab_motor$param)
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL"))) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
df_motor = df_selected %>%
gather(key = "side.nerve.param",
value = "value", c(R.MM.DML:R.TM.FL, L.MM.DML:L.TM.FL)) %>%
separate(side.nerve.param,
into = c("side", "nerve", "param"),
sep = "\\.") %>%
mutate(side.nerve = paste(side, nerve, sep=".")) %>%
mutate(side.nerve = factor(side.nerve,
levels =
c("R.MM", "R.UM", "R.PM", "R.TM",
"L.TM", "L.PM", "L.UM", "L.MM")))
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL"))) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
head(fu_selected)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date))
head(fu_selected)
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = round(length(levels(.$side.nerve))/2),
shareY = T, shareX = T,
titleX = F, titleY = T)
spg_plot_param = . %>%
plot_ly(x = ~Date, y = ~value, color = ~param,
legendgroup = ~param,
colors = "Dark2") %>%
add_lines(name = ~param, showlegend = F) %>%
add_markers(showlegend = F) %>%
add_annotations(
text = ~unique(side.nerve),
x = 0.5,
y = 1,
yref = "paper",
xref = "paper",
xanchor = "middle",
yanchor = "top",
showarrow = FALSE,
font = list(size = 15)
) %>%
layout(
xaxis = list(
showgrid = T
),
yaxis = list(
showgrid = T
))
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = round(length(levels(.$side.nerve))/2),
shareY = T, shareX = T,
titleX = F, titleY = T)
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = round(length(levels(.$side.nerve))/2),
shareY = T, shareX = T,
titleX = F, titleY = T)
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = round(length(levels(.$side.nerve))/2),
shareY = T, shareX = T,
titleX = F, titleY = T)
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
layout(p1, legend = list(font = list(size = 15)))
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
p = fu_selected %>%
group_by(side.nerve) %>%
filter(Date_rank %in% c(1,2,3)) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
p = fu_selected %>%
filter(Date_rank %in% c(1,2,3)) %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2,
shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
spg_plot_param = . %>%
plot_ly(x = ~Date, y = ~value, color = ~param,
legendgroup = ~param,
colors = "Dark2") %>%
add_lines(name = ~param, showlegend = F) %>%
add_markers(showlegend = F) %>%
add_annotations(
text = ~unique(side.nerve),
x = 0.5,
y = 1,
yref = "paper",
xref = "paper",
xanchor = "middle",
yanchor = "top",
showarrow = FALSE,
font = list(size = 15)
) %>%
layout(
xaxis = list(
showgrid = T
),
yaxis = list(
showgrid = T
))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2,
shareY = T, shareX = T,
titleX = F, titleY = T)
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL"))) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2,
shareY = T, shareX = T,
titleX = F, titleY = T)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2,
shareY = T, shareX = T,
titleX = F, titleY = T)
spg_plot_param = . %>%
plot_ly(x = ~Date, y = ~value, color = ~param,
legendgroup = ~param,
colors = "Dark2") %>%
add_lines(name = ~param, showlegend = F) %>%
add_markers(showlegend = F) %>%
add_annotations(
text = ~unique(side.nerve),
x = 0.5,
y = 1,
yref = "paper",
xref = "paper",
xanchor = "middle",
yanchor = "top",
showarrow = FALSE,
font = list(size = 15)
) %>%
layout(
xaxis = list(
showgrid = T
),
yaxis = list(
showgrid = T
))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2, shareY = T, shareX = T,
titleX = F, titleY = T)
head(fu_selected)
df_selected = df %>%
filter(ID == "1456214")
df_motor = df_selected %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d")) %>%
mutate_if(is.numeric, as.integer) %>%
gather(key = "side.nerve.param",
value = "value", c(R.MM.DML:R.TM.FL, L.MM.DML:L.TM.FL)) %>%
separate(side.nerve.param,
into = c("side", "nerve", "param"),
sep = "\\.") %>%
mutate(side.nerve = paste(side, nerve, sep=".")) %>%
mutate(side.nerve = factor(side.nerve,
levels =
c("R.MM", "R.UM", "R.PM", "R.TM",
"L.TM", "L.PM", "L.UM", "L.MM")))
df_motor_all = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2", "CMAP3", "CMAP4",
"DML", "Dur1", "Dur2", "Dur3", "Dur4",
"NCV1", "NCV2", "NCV3", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2", "CMAP3", "CMAP4",
"DML", "Dur1", "Dur2", "Dur3", "Dur4",
"NCV1", "NCV2", "NCV3", "FL"))) %>%
select(Date, side.nerve, param, value)
# FU view
fu_selected = df_motor %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d")) %>%
mutate_if(is.numeric, as.integer) %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param,
levels = c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL"))) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
spg_plot_param = . %>%
plot_ly(x = ~Date, y = ~value, color = ~param,
legendgroup = ~param,
colors = "Dark2") %>%
add_lines(name = ~param, showlegend = F) %>%
add_markers(showlegend = F) %>%
add_annotations(
text = ~unique(side.nerve),
x = 0.5,
y = 1,
yref = "paper",
xref = "paper",
xanchor = "middle",
yanchor = "top",
showarrow = FALSE,
font = list(size = 15)
) %>%
layout(
xaxis = list(
showgrid = T
),
yaxis = list(
showgrid = T
))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2, shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2, shareY = T, shareX = T,
titleX = F, titleY = T)
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param)) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
summary(fu_selected)
head(df_motor)
df = read_excel("BRM_GBS_NCS_2010_2017.xlsx", sheet = 1,
col_types = c("text", "text", rep("text", 3),
rep("numeric", 113)))
df_selected = df %>%
filter(ID == "1456214")
df_motor = df_selected %>%
mutate(Date = as.Date(Date, format = "%Y-%m-%d")) %>%
mutate_if(is.numeric, as.integer) %>%
gather(key = "side.nerve.param",
value = "value", c(R.MM.DML:R.TM.FL, L.MM.DML:L.TM.FL)) %>%
separate(side.nerve.param,
into = c("side", "nerve", "param"),
sep = "\\.") %>%
mutate(side.nerve = paste(side, nerve, sep=".")) %>%
mutate(side.nerve = factor(side.nerve,
levels =
c("R.MM", "R.UM", "R.PM", "R.TM",
"L.TM", "L.PM", "L.UM", "L.MM")))
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param)) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
summary(fu_selected)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
str(fu_selected)
fu_selected = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
head(fu_selected)
?arrange
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param)) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
temp = fu_selected %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
temp
temp = fu_selected %>%
arrange(Date)
temp
temp = fu_selected %>%
group_by(side.nerve, param) %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date)) %>%
filter(Date_rank %in% c(1,2,3))
temp
head(temp)
spg_plot_param = . %>%
plot_ly(x = ~Date, y = ~value, color = ~param,
legendgroup = ~param,
colors = "Dark2") %>%
add_lines(name = ~param, showlegend = F) %>%
add_markers(showlegend = F) %>%
add_annotations(
text = ~unique(side.nerve),
x = 0.5,
y = 1,
yref = "paper",
xref = "paper",
xanchor = "middle",
yanchor = "top",
showarrow = FALSE,
font = list(size = 15)
) %>%
layout(
xaxis = list(
showgrid = T
),
yaxis = list(
showgrid = T
))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 2, shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
p = fu_selected %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1, shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
# FU view
fu_selected = df_motor %>%
filter(param %in% c("CMAP1", "CMAP2",
"DML", "Dur1", "Dur2",
"NCV1", "FL")) %>%
mutate(param = factor(param)) %>%
select(Date, side.nerve, param, value) %>%
group_by(side.nerve) %>%
mutate(all_na = all(is.na(value))) %>%
filter(all_na == F)
fu_selected$side.nerve = factor(fu_selected$side.nerve)
temp = fu_selected %>%
group_by(side.nerve, param) %>%
arrange(Date) %>%
mutate(Date_rank = rank(Date))
range(temp$Date)
range(temp$Date_rank)
max(temp$Date_rank)
seq(1, 5)
unique(temp$Date)
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
head(fu_selected)
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
data.frame(sort(unique(fu_selected$Date)))
data.frame(date = sort(unique(fu_selected$Date)))
temp = data.frame(date = sort(unique(fu_selected$Date)))
temp$date
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
temp_date = data.frame(date = sort(unique(fu_selected$Date)))
temp_date
head(fu_selected)
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
fu_selected_sub = fu_selected %>%
filter(Date %in% temp_date$date)
p = fu_selected_sub %>%
group_by(side.nerve) %>%
do(p = spg_plot_param(.)) %>%
subplot(nrows = 1, shareY = T, shareX = T,
titleX = F, titleY = T)
p1 = style(p, traces = 1:7, showlegend = T)
layout(p1, legend = list(font = list(size = 15)))
temp_date
temp_date[c(1,2),]
data.frame(temp_date[c(1,2),])
data.frame(date = temp_date[c(1,2),])
runApp('~/Documents/GitHub/NCViewer/ncviewer.R')
q()
